{"version":3,"sources":["webpack:///webpack/bootstrap 3cc127391a1c0770ca5f","webpack:///./es6/main.js","webpack:///../lib/MipReducer.js","webpack:///../lib/Quad.js","webpack:///../lib/LinePlot.js","webpack:///../lib/util/index.js","webpack:///../lib/util/platform.js","webpack:///../lib/util/audio.js"],"names":["createShader","gl","source","type","shader","shaderSource","compileShader","window","createProgram","vertexShaderSource","fragmentShaderSource","options","defines","shaderPrefix","precisionPrefix","expandDefines","program","vshader","VERTEX_SHADER","fshader","FRAGMENT_SHADER","attachShader","deleteShader","beforeLink","linkProgram","log","getProgramInfoLog","console","getShaderInfoLog","defineStrings","keys","undefined","k","Object","runWebGL","updateTime","lastFrameStart","currentTime","Date","now","elapsedTime","startTime","lastFrameTime","simulationTime","paused","updateDeltaT","dt","newDeltaT","vec4","fromValues","generateFloat32Randoms","w","h","n","max","min","randoms","Float32Array","range","mid","i","Math","random","generateInt32Randoms","Int32Array","trunc","UINT32_MAX","INT32_MAX","generateParticleIndices","indices","makeIntRandomUniforms","RenderPass","constructor","_program","_uniformLocations","_options","uniformLocations","setUniformLocations","context","getUniformLocation","encode","uniforms","ops","assign","useProgram","beforeEncode","encodeUniforms","encodeTextures","encodeClear","checkFboStatus","encodeDraw","afterEncode","cleanupEncode","c","error","bindBuffer","ARRAY_BUFFER","bindVertexArray","bindFramebuffer","DRAW_FRAMEBUFFER","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","toString","PingPongProvider","_current","_textures","_framebuffers","_max","initFramebuffers","fboConfig","newFbo","createFramebuffer","framebufferTexture2D","colorAttachment","TEXTURE_2D","getNext","push","increment","registerTextures","texturesOrMonoid","getTexture","args","textures","Array","getCurrent","id","getCurrentId","getNextId","getPrev","getPrevId","getCurrentFbo","canvas","document","getElementById","style","width","height","offsetWidth","getContext","antialias","colorBufferFloatExt","getExtension","isWebGL2","innerHTML","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DEPTH_TEST","depthFunc","LESS","programParticles","textContent","programForceSplat","programFields","programGradients","programRenderFields","programLinePlotTransform","varyings","transformFeedbackVaryings","INTERLEAVED_ATTRIBS","programLinePlot","PARTICLE_MAX","parseInt","PARTICLE_WIDTH","particleResolution","vec2","renderResolution","drawingBufferWidth","drawingBufferHeight","particleIdx","particleIdxBuffer","createBuffer","bufferData","STATIC_DRAW","particleVertexArray","createVertexArray","particleIdxIndex","vertexAttribIPointer","INT","enableVertexAttribArray","particlePonger","particleRandomsAttachments","particleAttachments","particleMomentums","particleForces","map","f","activeTexture","TEXTURE0","tex","createTexture","bindTexture","texStorage2D","RGBA32I","texSubImage2D","RGBA_INTEGER","RGBA32F","RGBA","FLOAT","particleFboConfig","particleRandoms","COLOR_ATTACHMENT0","particles","COLOR_ATTACHMENT1","COLOR_ATTACHMENT2","COLOR_ATTACHMENT3","forceSplatTexture","forceSplatFbo","clearColor","clear","COLOR_BUFFER_BIT","fieldPonger","fieldRForceAttachments","fieldRForceGradientAttachments","fieldPongerFboConfig","repelField","repelFieldGradient","gradientPonger","gradientRForceAttachments","gradientPongerFboConfig","samplerNearest","createSampler","samplerParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","rpParticles","framebuffer","ONE","ZERO","viewport","resolution","uniform2fv","u_resolution","u_fieldResolution","fieldResolution","uniform4iv","u_randomSeed","randomSeed","uniform1f","u_particleSpeed","particleSpeed","uniform4fv","u_deltaTime","deltaTime","uniform1i","u_physicsMethod","physicsMethod","u_spaceType","spaceType","s_particleRandoms","s_particles","s_particleMomentums","s_particleForceSplat","s_repelField","bindSampler","TEXTURE1","TEXTURE2","TEXTURE3","particleForceSplat","TEXTURE4","drawBuffers","anyQuad","vertexArray","drawArrays","TRIANGLES","rpForceSplat","u_rCoefficient","rCoefficient","u_particleIdLimit","particleIdLimit","particleCount","particleUv","uniform2iv","u_particleUv","rpFields","u_fieldSize","fieldSize","u_fieldMinFactor","fieldMinFactor","u_deferGradientCalc","deferGradientCalc","u_circularFieldEffect","circularFieldEffect","u_forceCalcInGlPointSpace","forceCalcInGlPointSpace","POINTS","rpGradients","rpRenderFields","u_fractRenderValues","fractRenderValues","u_renderMagnitude","renderMagnitude","u_scaleRenderValues","scaleRenderValues","u_maxFieldLines","maxFieldLines","u_renderTexture","renderTexture","u_audioColorShiftEnabled","audioColorShiftEnabled","uniform3fv","u_audioColorShift","audioColorShift","s_repelFieldGradient","mipReducerMomentumSum","defaultValue","internalFormat","init","calc","write","mipReducerMomentumMinMax","Number","MAX_VALUE","MIN_VALUE","mipReducer","configure","MicrophoneInput","_loaded","_sampleRate","_isLive","_waveformSum","_waveformSumMax","_gain","initMic","audioContext","cb","_context","navigator","mediaDevices","getUserMedia","audio","then","catch","initMicError","initMicGraph","stream","micInput","createMediaStreamSource","scriptProcessor","createScriptProcessor","thisMic","onaudioprocess","event","inputData","inputBuffer","getChannelData","waveformSum","abs","updateMicUniform","connect","destination","e","getColorShift","rPeriod","gPeriod","bPeriod","vec3","enableControls","enabledCheckbox","checked","enabled","AudioContext","mic","activateMic","setTimeout","isLive","className","numDataPoints","hexColorToVec4","hex","substr","bsPrimary","bsSuccess","bsInfo","bsWarning","bsDanger","linePlots","momentum","plot","transformProgram","lineColor","lineWidth","value","dynamic","expiresAfter","buttonClass","force","fps","physicsMethods","brownian","splat","field","spaceTypes","finite","wrapped","infinite","resetParticles","resetParticlesWith","setResetParticles","setResetParticlesWith","particleResetVectorFields","x","y","zero","outward","inward","audioColorShiftGain","getUIElemements","ui","scaleForceToSpace","gain","r","g","b","getElementsByName","togglePlot","uiControlUpdate","renderTextureRadios","reduce","a","physicsMethodRadios","spaceTypeRadios","togglePause","pauseButton","configProfiles","defaults","forEach","el","parentElement","classList","remove","add","randomFactor","randomBoolean","chance","randomDataToggle","elemSet","pSet","rand","length","activateProfile","uiElements","framecount","lastAggregateTime","deltaT","debugPixels","renderDebugTexture","pixels","debugTexture","render","newPositions","newParticleMomentums","set","forceSplatUniforms","particleUniforms","fieldsUniforms","gradientTexture","gradientsUniforms","renderFieldsUniforms","renderFieldsOptions","reducedAggregates","MomentumSum","MomentumMinMax","quad","instantaneousFps","averageMomentum","innerText","encodeTransform","requestAnimationFrame","onload","AniPlatform","fixCanvasUIBar"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK,IAAI;;AAET,mBAAmB,8BAA8B;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oDAAoD;AACpD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,uDAAuD;AACvD,mBAAmB,8BAA8B;AACjD;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,8CAA8C,EAAE;AAChD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,wFAAwF,EAAE;;AAE1F;AACA;;AAEA;AACA;;AAEA,oCAAoC;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,mBAAmB,sBAAsB;AACzC;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,oDAAoD,EAAE;AACtD;AACA;AACA;AACA,KAAK,IAAI;;AAET;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;;;;;;;ACvbA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEQ;;;;;;;;AC1GR;AAAA;AACA,yCAAyC;AACzC;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gCAAgC;AAChC,gCAAgC;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,aAAa,kBAAkB;AAC/B,gBAAgB,iBAAiB;AACjC,iBAAiB,sBAAsB;AACvC,wBAAwB,yBAAyB;AACjD,qBAAqB,0BAA0B;AAC/C,gCAAgC,iCAAiC;;AAEjE,iBAAiB,sBAAsB;AACvC,wBAAwB,yBAAyB;AACjD,0BAA0B,+BAA+B;AACzD,0CAA0C,2CAA2C;;AAErF,0BAA0B,+BAA+B;AACzD,mCAAmC,wCAAwC;;AAE3E;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAuC;AACvC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,gFAAgF;AAChF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,8BAA8B;AAC9B;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA,yBAAyB,gBAAgB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;ACzTuB;AACF;;;;;;;;;ACDrB;AAAA;;AAEA,oDAAoD,uCAAuC;AAC3F;AACA;AACA,8CAA8C,QAAQ;;AAEtD,8DAA8D;AAC9D;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,+8DAA+8D;AACh+D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,kCAAkC,oBAAoB;AACtD;AACA;;AAEA;;;;;;;;;ACjDA;AAAA;AACA;;AAEA;;AAEA","file":"2017-06-29-animating-the-gradient.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3cc127391a1c0770ca5f","import { MipReducerAttachment, MipReducer } from '../../lib/MipReducer.js';\nimport { Quad } from '../../lib/Quad.js';\nimport { LinePlot } from '../../lib/LinePlot.js';\n\nimport { Platform as AniPlatform } from '../../lib/util';\n\nfunction createShader(gl, source, type) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, source);\n  gl.compileShader(shader);\n  return shader;\n}\n\nwindow.createProgram = function (gl, vertexShaderSource, fragmentShaderSource, options = {}) {\n  var defines = options.defines || {};\n\n  var shaderPrefix = \"#version 300 es\\n\";\n  shaderPrefix += \"#extension EXT_color_buffer_float : enable\\n\";\n  shaderPrefix += \"#extension OES_texture_float_linear: enable\\n\";\n\n  var precisionPrefix = `\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    precision highp usampler2D;\n    precision highp isampler2D;\n    `;\n\n  vertexShaderSource = shaderPrefix + expandDefines(defines) + precisionPrefix + vertexShaderSource;\n  fragmentShaderSource = shaderPrefix + expandDefines(defines) + precisionPrefix + fragmentShaderSource;\n\n  var program = gl.createProgram();\n  var vshader = createShader(gl, vertexShaderSource, gl.VERTEX_SHADER);\n  var fshader = createShader(gl, fragmentShaderSource, gl.FRAGMENT_SHADER);\n  gl.attachShader(program, vshader);\n  gl.deleteShader(vshader);\n  gl.attachShader(program, fshader);\n  gl.deleteShader(fshader);\n\n  if (options.beforeLink) {\n    options.beforeLink(gl, program);\n  }\n\n  gl.linkProgram(program);\n\n  var log = gl.getProgramInfoLog(program);\n  if (log) {\n    console.log(log);\n  }\n\n  log = gl.getShaderInfoLog(vshader);\n  if (log) {\n    console.log(log);\n  }\n\n  log = gl.getShaderInfoLog(fshader);\n  if (log) {\n    console.log(log);\n  }\n\n  return program;\n};\n\nwindow.expandDefines = function (defines = {}) {\n  // TODO: fix this?\n  var defineStrings = \"\";\n  if (defines.keys !== undefined) {\n    for (var k in Object.keys(defines)) {\n      defineStrings += `#define ${k} ${defines[k]}\\n`;\n    }\n  }\n\n  return defineStrings;\n};\n\nfunction runWebGL() {\n\n  function updateTime() {\n    lastFrameStart = currentTime;\n    currentTime = Date.now();\n    elapsedTime = currentTime - startTime;\n    lastFrameTime = currentTime - lastFrameStart;\n\n    // TODO: check simluationTime\n    simulationTime += (paused ? 0 : lastFrameTime);\n  }\n\n  function updateDeltaT(dt, newDeltaT) {\n    return vec4.fromValues(newDeltaT, dt[0], dt[1], dt[2]);\n  }\n\n// =======================================\n// Generate Texture Data\n// =======================================\n\n  function generateFloat32Randoms(w, h, n, max = 1, min = 0) {\n    var randoms = new Float32Array(w * h * n);\n    var range = max - min;\n    var mid = min + range/2;\n    for (var i = 0; i < (w * h * n); i++) {\n      randoms[i] = Math.random() * range + min;\n    }\n    return randoms\n  }\n\n  function generateInt32Randoms(w, h, n) {\n    var randoms = new Int32Array(w * h * n);\n    for (var i = 0; i < (w * h * n); i++) {\n      randoms[i] = Math.trunc(Math.random() * UINT32_MAX - INT32_MAX);\n    }\n    return randoms\n  }\n\n  function generateParticleIndices(h, w) {\n    var indices = new Int32Array(h * w);\n    for (var i = 0; i < (h * w); i++) {\n      indices[i] = i;\n    }\n    return indices;\n  }\n\n  function makeIntRandomUniforms() {\n    return new Int32Array([\n      Math.trunc(Math.random() * UINT32_MAX - INT32_MAX),\n      Math.trunc(Math.random() * UINT32_MAX - INT32_MAX),\n      Math.trunc(Math.random() * UINT32_MAX - INT32_MAX),\n      Math.trunc(Math.random() * UINT32_MAX - INT32_MAX)\n    ]);\n  }\n\n// =======================================\n// Geometry\n// =======================================\n\n  class RenderPass {\n    constructor(program, options = {}) {\n      this._program = program;\n      this._uniformLocations = {};\n      this._options = options;\n    }\n\n    get program() { return this._program; }\n    set program(program) { this._program = program; }\n    get options() { return this._options; }\n    set options(options) { this._options = options; }\n\n    get uniformLocations() {\n      return this._uniformLocations;\n    }\n\n    set uniformLocations(uniformLocations) {\n      this._uniformLocations = uniformLocations;\n    }\n\n    setUniformLocations(context, keys) {\n      var uniformLocations = {};\n      for (var k of keys) {\n        uniformLocations[k] = context.getUniformLocation(this.program, k);\n      }\n      this._uniformLocations = uniformLocations;\n    }\n\n    encode(context, uniforms, options = {}) {\n      var ops = Object.assign({}, this.options, options);\n\n      context.useProgram(ops.program || this.program);\n\n      // for each key in uniforms, encode value into the specific location\n      if (ops.beforeEncode !== undefined) {\n        ops.beforeEncode(context, uniforms, ops);\n      }\n\n      if (ops.encodeUniforms !== undefined) {\n        ops.encodeUniforms(context, uniforms, ops);\n      } else {\n        this.encodeUniforms(context, uniforms, ops);\n      }\n\n      if (ops.encodeTextures !== undefined) {\n        ops.encodeTextures(context, uniforms, ops);\n      }\n\n      if (ops.encodeClear !== undefined) {\n        ops.encodeClear(context, uniforms, ops);\n      }\n\n      this.checkFboStatus(context);\n\n      if (ops.encodeDraw !== undefined) {\n        ops.encodeDraw(context, uniforms, ops);\n      } else {\n        this.encodeDraw(context, uniforms, ops);\n      }\n\n      if (ops.afterEncode !== undefined) {\n        ops.afterEncode(context, uniforms, ops);\n      }\n\n      this.cleanupEncode(context);\n    }\n\n    encodeUniforms(c, uniforms, options = {}) {\n      console.error(\"RenderPass: override encodeUniforms() or pass 'encodeUniforms'\")\n    }\n\n    encodeDraw(c, uniforms, options = {}) {\n      console.error(\"RenderPass: override encodeDraw() or pass 'encodeDraw'\")\n    }\n\n    cleanupEncode(context) {\n      context.bindBuffer(context.ARRAY_BUFFER, null);\n      context.bindVertexArray(null);\n      context.useProgram(null);\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, null);\n    }\n\n    checkFboStatus(context) {\n      var status = context.checkFramebufferStatus(context.DRAW_FRAMEBUFFER);\n      if (status != context.FRAMEBUFFER_COMPLETE) {\n        console.error('fb status: ' + status.toString(10));\n      }\n    }\n  }\n\n// =======================================\n// PingPongProvider\n// =======================================\n\n  class PingPongProvider {\n    constructor (options = {}) {\n      this._current = 0;\n      this._textures = {};\n      this._framebuffers = [];\n      this._max = options.max || 2;\n    }\n\n    initFramebuffers(context, fboConfig) {\n      for (var i = 0; i < this._max; i++) {\n        var newFbo = context.createFramebuffer();\n        context.bindFramebuffer(context.DRAW_FRAMEBUFFER, newFbo);\n        for (var k in fboConfig) {\n          context.framebufferTexture2D(context.DRAW_FRAMEBUFFER, fboConfig[k].colorAttachment, context.TEXTURE_2D, this.getNext(k), 0);\n        }\n        context.bindFramebuffer(context.DRAW_FRAMEBUFFER, null);\n        this._framebuffers.push(newFbo);\n        this.increment();\n      }\n    }\n\n    registerTextures(k, texturesOrMonoid) {\n      this._textures[k] = texturesOrMonoid;\n    }\n\n    getTexture(k, i, ...args) {\n      var textures = this._textures[k];\n      if (textures === undefined) {\n        console.error(`PingPongProvider: key ${k} is undefined`);\n      } else {\n        if (textures instanceof Array) {\n          return textures[i];\n        } else {\n          // TODO: decide whether to pass `this`\n          // return textures(this, i, ...args);\n          return textures(...args);\n        }\n      }\n    }\n\n    getCurrent(k, ...args) {\n      var id = this.getCurrentId();\n      return this.getTexture(k, id, ...args);\n    }\n\n    getNext(k,  ...args) {\n      var id = this.getNextId();\n      return this.getTexture(k, id, ...args);\n    }\n\n    getPrev(k, ...args) {\n      var id = this.getPrevId();\n      return this.getTexture(k, id, ...args);\n    }\n\n    getCurrentFbo() {\n      // TODO: may need to fix the id...\n      return this._framebuffers[this.getCurrentId()];\n    }\n\n    getCurrentId() {\n      return this._current;\n    }\n\n    getNextId() {\n      if (this._current == this._max - 1) {\n        return 0;\n      } else {\n        return this._current + 1;\n      }\n    }\n\n    getPrevId() {\n      if (this._current == 0) {\n        return this._max - 1;\n      } else {\n        return this._current - 1;\n      }\n    }\n\n    increment() {\n      if (this._current == this._max - 1) {\n        this._current = 0;\n      } else {\n        this._current++;\n      }\n    }\n  }\n\n// =======================================\n// Canvas & WebGL\n// =======================================\n\n  var canvas = document.getElementById('main-canvas');\n  canvas.style.width = '100%';\n  canvas.height = 500;\n  canvas.width = canvas.offsetWidth;\n\n  var gl = canvas.getContext('webgl2', {antialias: true});\n  var colorBufferFloatExt = gl.getExtension('EXT_color_buffer_float');\n  if (!colorBufferFloatExt) {\n    console.error(\"EXT_color_buffer_float not supported.\")\n  }\n\n  var isWebGL2 = !!gl;\n  if (!isWebGL2) {\n    document.getElementById('info').innerHTML = 'WebGL 2 is not available.  See <a href=\"https://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">How to get a WebGL 2 implementation</a>';\n    console.error('WebGL 2 is not available.')\n  }\n\n  gl.enable(gl.BLEND);\n  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n  gl.enable(gl.DEPTH_TEST);\n  gl.depthFunc(gl.LESS);\n\n  var UINT32_MAX = (2 ** 32) - 1;\n  var INT32_MAX = (2 ** 31) - 1;\n\n// =======================================\n// GLSL Programs\n// =======================================\n\n  var programParticles = createProgram(gl,\n    document.getElementById('vsPass').textContent,\n    document.getElementById('fsUpdateParticles').textContent);\n\n  var programForceSplat = createProgram(gl,\n    document.getElementById('vsPass').textContent,\n    document.getElementById('fsForceSplat').textContent);\n\n  var programFields = createProgram(gl,\n    document.getElementById('vsFields').textContent,\n    document.getElementById('fsFields').textContent);\n\n  var programGradients = createProgram(gl,\n    document.getElementById('vsPass').textContent,\n    document.getElementById('fsGradients').textContent);\n\n  var programRenderFields = createProgram(gl,\n    document.getElementById('vsPass').textContent,\n    document.getElementById('fsRenderFields').textContent);\n\n  var programLinePlotTransform = createProgram(gl,\n    document.getElementById('vsLinePlotTransform').textContent,\n    document.getElementById('fsNull').textContent,\n    {\n      beforeLink: (context, program) => {\n        var varyings = ['v_positionA', 'v_positionB'];\n        context.transformFeedbackVaryings(program, varyings, context.INTERLEAVED_ATTRIBS);\n      }\n    });\n\n  var programLinePlot = createProgram(gl,\n    document.getElementById('vsLinePlot').textContent,\n    document.getElementById('fsLinePlot').textContent);\n\n// =======================================\n// Particles\n// =======================================\n\n  var PARTICLE_MAX = parseInt(document.getElementById('particle-count').max);\n  var PARTICLE_WIDTH = 32;\n  var particleResolution = vec2.fromValues(PARTICLE_WIDTH, PARTICLE_MAX/PARTICLE_WIDTH);\n  var renderResolution = vec2.fromValues(gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n  var particleIdx = generateParticleIndices(particleResolution[0], particleResolution[1]);\n\n  var particleIdxBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, particleIdxBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, particleIdx, gl.STATIC_DRAW);\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n  var particleVertexArray = gl.createVertexArray();\n  gl.bindVertexArray(particleVertexArray);\n\n  var particleIdxIndex = 0;\n  gl.bindBuffer(gl.ARRAY_BUFFER, particleIdxBuffer);\n  gl.vertexAttribIPointer(particleIdxIndex, 1, gl.INT, false, 0, 0);\n  gl.enableVertexAttribArray(particleIdxIndex);\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n  gl.bindVertexArray(null);\n\n  var particlePonger = new PingPongProvider({max: 3});\n\n  var particleRandomsAttachments,\n    particleAttachments,\n    particleMomentums,\n    particleForces;\n\n  particleRandomsAttachments = [0,1,2].map((f) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32I, particleResolution[0], particleResolution[1]);\n    gl.texSubImage2D(gl.TEXTURE_2D,\n      0,\n      0, // x offset\n      0, // y offset\n      particleResolution[0],\n      particleResolution[1],\n      gl.RGBA_INTEGER,\n      gl.INT,\n      generateInt32Randoms(particleResolution[0], particleResolution[1], 4));\n\n    // TODO: load random seeds from image\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex\n  });\n\n  particleAttachments = [0,1,2].map((f) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, particleResolution[0], particleResolution[1]);\n    gl.texSubImage2D(gl.TEXTURE_2D,\n      0,\n      0, // x offset\n      0, // y offset\n      particleResolution[0],\n      particleResolution[1],\n      gl.RGBA,\n      gl.FLOAT,\n      generateFloat32Randoms(particleResolution[0], particleResolution[1], 4, -0.5, 0.5));\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  particleMomentums = [0,1,2].map((f) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, particleResolution[0], particleResolution[1]);\n    gl.texSubImage2D(gl.TEXTURE_2D,\n      0,\n      0, // x offset\n      0, // y offset\n      particleResolution[0],\n      particleResolution[1],\n      gl.RGBA,\n      gl.FLOAT,\n      generateFloat32Randoms(particleResolution[0], particleResolution[1], 4, -0.05, 0.05)\n    );\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  particleForces = [0,1,2].map((f) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, particleResolution[0], particleResolution[1]);\n    gl.texSubImage2D(gl.TEXTURE_2D,\n      0,\n      0, // x offset\n      0, // y offset\n      particleResolution[0],\n      particleResolution[1],\n      gl.RGBA,\n      gl.FLOAT,\n      new Float32Array(particleResolution[0] * particleResolution[1] * 4)\n    );\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  particlePonger.registerTextures('particleRandoms', particleRandomsAttachments);\n  particlePonger.registerTextures('particles', particleAttachments);\n  particlePonger.registerTextures('particleMomentums', particleMomentums);\n  particlePonger.registerTextures('particleForces', particleForces);\n\n  var particleFboConfig = {\n    particleRandoms: {\n      colorAttachment: gl.COLOR_ATTACHMENT0\n    },\n    particles: {\n      colorAttachment: gl.COLOR_ATTACHMENT1\n    },\n    particleMomentums: {\n      colorAttachment: gl.COLOR_ATTACHMENT2\n    },\n    particleForces: {\n      colorAttachment: gl.COLOR_ATTACHMENT3\n    }\n  };\n\n  particlePonger.initFramebuffers(gl, particleFboConfig);\n\n// =======================================\n// Force Splatting Texture\n// =======================================\n\n  gl.activeTexture(gl.TEXTURE0);\n  var forceSplatTexture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, forceSplatTexture);\n  gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, particleResolution[0], particleResolution[1]);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n\n  var forceSplatFbo = gl.createFramebuffer();\n  gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, forceSplatFbo);\n  gl.framebufferTexture2D(gl.DRAW_FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, forceSplatTexture, 0);\n  gl.clearColor(0.0,0.0,0.0,0.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n  gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n\n// =======================================\n// Aggregate Filter Textures\n// =======================================\n\n// TODO: limit particles for aggregate calculations to particleCount\n//gl.activeTexture(gl.TEXTURE0);\n//var aggregateTextures = ['momentum', 'deltaMomentum', 'force', 'deltaForce'].reduce((acc, k) => {\n//  var tex = gl.createTexture();\n//  gl.bindTexture(gl.TEXTURE_2D, tex);\n//  aggregateTextures.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, particleResolution[0], particleResolution[1]);\n//  acc[k] = tex;\n//  return acc\n//});\n//gl.bindTexture(gl.TEXTURE_2D, null);\n\n// =======================================\n// Fields & Gradients\n// =======================================\n\n  var fieldPonger = new PingPongProvider({max: 3});\n  var fieldRForceAttachments, fieldRForceGradientAttachments;\n\n  fieldRForceAttachments = [0,1,2].map((i) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, renderResolution[0], renderResolution[1]);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  fieldRForceGradientAttachments = [0,1,2].map((i) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, renderResolution[0], renderResolution[1]);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  fieldPonger.registerTextures('repelField', fieldRForceAttachments);\n  fieldPonger.registerTextures('repelFieldGradient', fieldRForceGradientAttachments);\n\n  var fieldPongerFboConfig = {\n    repelField: { colorAttachment: gl.COLOR_ATTACHMENT0 },\n    repelFieldGradient: { colorAttachment: gl.COLOR_ATTACHMENT1 }\n  };\n\n  fieldPonger.initFramebuffers(gl, fieldPongerFboConfig);\n  for (var i in fieldPonger._framebuffers) {\n    gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, fieldPonger._framebuffers[i]);\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n  };\n\n// =======================================\n// Gradients\n// =======================================\n\n  var gradientPonger = new PingPongProvider({max: 3});\n  var gradientRForceAttachments;\n\n  gradientRForceAttachments = [0,1,2].map((i) => {\n    gl.activeTexture(gl.TEXTURE0);\n    var tex = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, tex);\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, renderResolution[0], renderResolution[1]);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return tex;\n  });\n\n  gradientPonger.registerTextures('repelFieldGradient', gradientRForceAttachments);\n\n  var gradientPongerFboConfig = {\n    repelFieldGradient: { colorAttachment: gl.COLOR_ATTACHMENT0 }\n  };\n\n  gradientPonger.initFramebuffers(gl, gradientPongerFboConfig);\n  for (var i in gradientPonger._framebuffers) {\n    gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, gradientPonger._framebuffers[i]);\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n  };\n\n// =======================================\n// Texture Samplers\n// =======================================\n\n  var samplerNearest = gl.createSampler();\n  gl.samplerParameteri(samplerNearest, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.samplerParameteri(samplerNearest, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n  gl.samplerParameteri(samplerNearest, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.samplerParameteri(samplerNearest, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n// =======================================\n// Render Pass: Particles\n// =======================================\n\n  var rpParticles = new RenderPass(programParticles, {\n    beforeEncode: (context, uniforms, ops) => {\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, ops.framebuffer);\n      context.blendFunc(context.ONE, context.ZERO);\n      context.viewport(0, 0, uniforms.resolution[0], uniforms.resolution[1]);\n    },\n    encodeUniforms: (context, uniforms, ops) => {\n      context.uniform2fv(rpParticles.uniformLocations.u_resolution, uniforms.resolution);\n      context.uniform2fv(rpParticles.uniformLocations.u_fieldResolution, uniforms.fieldResolution);\n      context.uniform4iv(rpParticles.uniformLocations.u_randomSeed, uniforms.randomSeed);\n      context.uniform1f(rpParticles.uniformLocations.u_particleSpeed, uniforms.particleSpeed);\n      context.uniform4fv(rpParticles.uniformLocations.u_deltaTime, uniforms.deltaTime);\n      context.uniform1i(rpParticles.uniformLocations.u_physicsMethod, uniforms.physicsMethod);\n      context.uniform1i(rpParticles.uniformLocations.u_spaceType, uniforms.spaceType);\n      context.uniform1i(rpParticles.uniformLocations.s_particleRandoms, 0);\n      context.uniform1i(rpParticles.uniformLocations.s_particles, 1);\n      context.uniform1i(rpParticles.uniformLocations.s_particleMomentums, 2);\n      context.uniform1i(rpParticles.uniformLocations.s_particleForceSplat, 3);\n      context.uniform1i(rpParticles.uniformLocations.s_repelField, 4);\n    },\n    encodeTextures: (context, uniforms, ops) => {\n      context.activeTexture(context.TEXTURE0);\n      context.bindTexture(context.TEXTURE_2D, ops.particleRandoms);\n      context.bindSampler(0, samplerNearest);\n\n      context.activeTexture(context.TEXTURE1);\n      context.bindTexture(context.TEXTURE_2D, ops.particles);\n      context.bindSampler(1, samplerNearest);\n\n      context.activeTexture(context.TEXTURE2);\n      context.bindTexture(context.TEXTURE_2D, ops.particleMomentums);\n      context.bindSampler(2, samplerNearest);\n\n      context.activeTexture(context.TEXTURE3);\n      context.bindTexture(context.TEXTURE_2D, ops.particleForceSplat);\n      context.bindSampler(3, samplerNearest);\n\n      context.activeTexture(context.TEXTURE4);\n      context.bindTexture(context.TEXTURE_2D, ops.repelField);\n      context.bindSampler(4, samplerNearest);\n    },\n    encodeDraw: (context, uniforms, ops) => {\n      context.drawBuffers([\n        context.COLOR_ATTACHMENT0,\n        context.COLOR_ATTACHMENT1,\n        context.COLOR_ATTACHMENT2,\n        context.COLOR_ATTACHMENT3\n      ]);\n\n      context.bindVertexArray(anyQuad.vertexArray);\n      context.drawArrays(context.TRIANGLES, 0, 6);\n    }\n  });\n\n  rpParticles.setUniformLocations(gl, [\n    'u_resolution',\n    'u_fieldResolution',\n    'u_randomSeed',\n    'u_particleSpeed',\n    'u_deltaTime',\n    'u_physicsMethod',\n    'u_spaceType',\n    's_particleRandoms',\n    's_particles',\n    's_particleMomentums',\n    's_particleForceSplat',\n    's_repelField'\n  ]);\n\n// =======================================\n// Render Pass: Force Splatting\n// =======================================\n\n  var rpForceSplat = new RenderPass(programForceSplat, {\n    beforeEncode: (context, uniforms, ops) => {\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, ops.framebuffer);\n      context.blendFunc(context.ONE, context.ONE);\n      context.viewport(0, 0, uniforms.resolution[0], uniforms.resolution[1]);\n      context.clearColor(0.0,0.0,0.0,0.0);\n      context.clear(gl.COLOR_BUFFER_BIT);\n    },\n    encodeUniforms: (context, uniforms, ops) => {\n      context.uniform2fv(rpForceSplat.uniformLocations.u_resolution, uniforms.resolution);\n      context.uniform1f(rpForceSplat.uniformLocations.u_rCoefficient, uniforms.rCoefficient);\n      context.uniform1i(rpForceSplat.uniformLocations.u_particleIdLimit, uniforms.particleIdLimit);\n      context.uniform1i(rpForceSplat.uniformLocations.s_particles, 0);\n    },\n    encodeTextures: (context, uniforms, ops) => {\n      context.activeTexture(context.TEXTURE0);\n      context.bindTexture(context.TEXTURE_2D, ops.particles);\n      context.bindSampler(0, samplerNearest);\n    },\n    encodeDraw: (context, uniforms, ops) => {\n      context.drawBuffers([\n        context.COLOR_ATTACHMENT0\n      ]);\n\n      for (var i = 0; i < ops.particleCount; i++) {\n        var particleUv = [i % particleResolution[0], Math.trunc(i / particleResolution[1])];\n        context.uniform2iv(rpForceSplat.uniformLocations.u_particleUv, particleUv);\n        context.bindVertexArray(anyQuad.vertexArray);\n        context.drawArrays(context.TRIANGLES, 0, 6);\n      }\n    }\n  });\n\n  rpForceSplat.setUniformLocations(gl, [\n    'u_resolution',\n    'u_particleUv',\n    'u_rCoefficient',\n    'u_particleIdLimit',\n    's_particles'\n  ]);\n\n// =======================================\n// Render Pass: Fields\n// =======================================\n\n  var rpFields = new RenderPass(programFields, {\n    beforeEncode: (context, uniforms, ops) => {\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, ops.framebuffer);\n      context.blendFunc(context.ONE, context.ONE);\n      context.viewport(0, 0, uniforms.resolution[0], uniforms.resolution[1]);\n    },\n    encodeClear: (context, uniforms, ops) => {\n      context.clearColor(0.0, 0.0, 0.0, 1.0);\n      context.clear(context.COLOR_BUFFER_BIT);\n    },\n    encodeUniforms: (context, uniforms, ops) => {\n      context.uniform2fv(rpFields.uniformLocations.u_resolution, uniforms.resolution);\n      context.uniform1f(rpFields.uniformLocations.u_fieldSize, uniforms.fieldSize);\n      context.uniform1f(rpFields.uniformLocations.u_rCoefficient, uniforms.rCoefficient);\n      context.uniform1f(rpFields.uniformLocations.u_fieldMinFactor, uniforms.fieldMinFactor);\n      context.uniform1i(rpFields.uniformLocations.u_deferGradientCalc, (uniforms.deferGradientCalc ? 1 : 0));\n      context.uniform1i(rpFields.uniformLocations.u_circularFieldEffect, (uniforms.circularFieldEffect ? 1 : 0));\n      context.uniform1i(rpFields.uniformLocations.u_forceCalcInGlPointSpace, (uniforms.forceCalcInGlPointSpace ? 1 : 0));\n      context.uniform1i(rpFields.uniformLocations.s_particles, 0);\n    },\n    encodeTextures: (context, uniforms, ops) => {\n      context.activeTexture(context.TEXTURE0);\n      context.bindTexture(context.TEXTURE_2D, ops.particles);\n      context.bindSampler(0, samplerNearest);\n\n      // TODO: add particleMomentums texture (any need for color here?)\n      // - or should i add a frequency that the particles' fields resonate at?\n    },\n    encodeDraw: (context, uniforms, ops) => {\n      context.drawBuffers([\n        context.COLOR_ATTACHMENT0,\n        context.COLOR_ATTACHMENT1\n      ]);\n\n      context.bindVertexArray(particleVertexArray);\n      context.drawArrays(context.POINTS, 0, ops.particleCount);\n    }\n  });\n\n  rpFields.setUniformLocations(gl, [\n    'u_resolution',\n    'u_fieldSize',\n    'u_rCoefficient',\n    'u_fieldMinFactor',\n    's_particles',\n    'u_deferGradientCalc',\n    'u_circularFieldEffect',\n    'u_forceCalcInGlPointSpace'\n  ]);\n\n// =======================================\n// Render Pass: Gradients\n// =======================================\n\n  var rpGradients = new RenderPass(programGradients, {\n    beforeEncode: (context, uniforms, ops) => {\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, ops.framebuffer);\n      context.blendFunc(context.ONE, context.ZERO);\n      context.viewport(0, 0, uniforms.resolution[0], uniforms.resolution[1]);\n    },\n    encodeClear: (context, uniforms, ops) => {\n      context.clearColor(0.0, 0.0, 0.0, 1.0);\n      context.clear(context.COLOR_BUFFER_BIT);\n    },\n    encodeUniforms: (context, uniforms, ops) => {\n      context.uniform2fv(rpGradients.uniformLocations.u_resolution, uniforms.resolution);\n      context.uniform1i(rpGradients.uniformLocations.s_repelField, 0);\n    },\n    encodeTextures: (context, uniforms, ops) => {\n      context.activeTexture(context.TEXTURE0);\n      context.bindTexture(context.TEXTURE_2D, ops.repelField);\n      context.bindSampler(0, samplerNearest);\n    },\n    encodeDraw: (context, uniforms, ops) => {\n      context.drawBuffers([\n        context.COLOR_ATTACHMENT0\n      ]);\n\n      context.bindVertexArray(anyQuad.vertexArray);\n      context.drawArrays(context.TRIANGLES, 0, 6);\n    }\n  });\n\n  rpGradients.setUniformLocations(gl, [\n    'u_resolution',\n    's_repelField'\n  ]);\n\n// =======================================\n// Render Pass: Fields\n// =======================================\n\n  var rpRenderFields = new RenderPass(programRenderFields, {\n    beforeEncode: (context, uniforms, ops) => {\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, ops.framebuffer);\n      context.blendFunc(context.ONE, context.ZERO);\n      context.viewport(0, 0, uniforms.resolution[0], uniforms.resolution[1]);\n      context.clearColor(0.0, 0.0, 0.0, 1.0);\n      context.clear(context.COLOR_BUFFER_BIT);\n    },\n    encodeUniforms: (context, uniforms, ops) => {\n      context.uniform2fv(rpRenderFields.uniformLocations.u_resolution, uniforms.resolution);\n      context.uniform1f(rpRenderFields.uniformLocations.u_rCoefficient, uniforms.rCoefficient);\n      context.uniform1i(rpRenderFields.uniformLocations.u_fractRenderValues, (uniforms.fractRenderValues ? 1 : 0));\n      context.uniform1i(rpRenderFields.uniformLocations.u_renderMagnitude, (uniforms.renderMagnitude ? 1 : 0));\n      context.uniform1i(rpRenderFields.uniformLocations.u_scaleRenderValues, (uniforms.scaleRenderValues ? 1 : 0));\n      context.uniform1f(rpRenderFields.uniformLocations.u_maxFieldLines, uniforms.maxFieldLines);\n      context.uniform1i(rpRenderFields.uniformLocations.u_renderTexture, uniforms.renderTexture);\n      context.uniform1i(rpRenderFields.uniformLocations.u_audioColorShiftEnabled, uniforms.audioColorShiftEnabled);\n      context.uniform3fv(rpRenderFields.uniformLocations.u_audioColorShift, uniforms.audioColorShift);\n      context.uniform1i(rpRenderFields.uniformLocations.s_repelField, 0);\n      context.uniform1i(rpRenderFields.uniformLocations.s_repelFieldGradient, 1);\n    },\n    encodeTextures: (context, uniforms, ops) => {\n      context.activeTexture(context.TEXTURE0);\n      context.bindTexture(context.TEXTURE_2D, ops.repelField);\n      context.bindSampler(0, samplerNearest);\n\n      context.activeTexture(context.TEXTURE1);\n      context.bindTexture(context.TEXTURE_2D, ops.repelFieldGradient);\n      context.bindSampler(1, samplerNearest);\n    },\n    encodeDraw: (context, uniforms, ops) => {\n      context.bindVertexArray(anyQuad.vertexArray);\n      context.drawArrays(context.TRIANGLES, 0, 6);\n    }\n  });\n\n  rpRenderFields.setUniformLocations(gl, [\n    'u_resolution',\n    'u_rCoefficient',\n    'u_renderTexture',\n    'u_fractRenderValues',\n    'u_maxFieldLines',\n    'u_renderMagnitude',\n    'u_scaleRenderValues',\n    'u_audioColorShift',\n    'u_audioColorShiftEnabled',\n    's_repelField',\n    's_repelFieldGradient'\n  ]);\n\n  var mipReducerMomentumSum = new MipReducerAttachment({\n    id: 'MomentumSum',\n    defaultValue: vec4.fromValues(0.0,0.0,0.0,0.0),\n    internalFormat: gl.RGBA32F,\n    init:\n    \"${texels}[0].z = distance(${texels}[0].xy, vec2(0.0,0.0));\\n\" +\n    \"${texels}[1].z = distance(${texels}[1].xy, vec2(0.0,0.0));\\n\" +\n    \"${texels}[2].z = distance(${texels}[2].xy, vec2(0.0,0.0));\\n\" +\n    \"${texels}[3].z = distance(${texels}[3].xy, vec2(0.0,0.0));\\n\",\n    calc:\n    \"vec2 momentumSum = vec2(${texels}[0].xy + ${texels}[1].xy + ${texels}[2].xy + ${texels}[3].xy);\\n\" +\n    \"float momentumNormSum = ${texels}[0].z + ${texels}[1].z + ${texels}[2].z + ${texels}[3].z; \\n\",\n    write: \"vec4(momentumSum.xy, momentumNormSum, 0.0);\"\n  });\n\n  var mipReducerMomentumMinMax = new MipReducerAttachment({\n    id: 'MomentumMinMax',\n    defaultValue: vec4.fromValues(Number.MAX_VALUE, Number.MIN_VALUE, 0.0, 0.0),\n    internalFormat: gl.RGBA32F,\n    init:\n    \"${texels}[0].xy = vec2(distance(${texels}[0].xy, vec2(0.0,0.0)), distance(${texels}[0].xy, vec2(0.0,0.0)));\\n\" +\n    \"${texels}[1].xy = vec2(distance(${texels}[1].xy, vec2(0.0,0.0)), distance(${texels}[1].xy, vec2(0.0,0.0)));\\n\" +\n    \"${texels}[2].xy = vec2(distance(${texels}[2].xy, vec2(0.0,0.0)), distance(${texels}[2].xy, vec2(0.0,0.0)));\\n\" +\n    \"${texels}[3].xy = vec2(distance(${texels}[3].xy, vec2(0.0,0.0)), distance(${texels}[3].xy, vec2(0.0,0.0)));\\n\",\n    write: \"vec4(min(min(min(${texels}[0].x,${texels}[1].x),${texels}[2].x),${texels}[3].x), \\n\" +\n    \"max(max(max(${texels}[0].y,${texels}[1].y),${texels}[2].y),${texels}[3].y), \\n\" +\n    \"0.0,0.0);\"\n  });\n\n  var mipReducer = new MipReducer(particleResolution, [\n    mipReducerMomentumSum,\n    mipReducerMomentumMinMax //,\n  ], {\n    uniforms: {\n      'u_particleCount': 'int'\n    }\n  });\n\n  mipReducer.configure(gl, {});\n\n// =======================================\n// Render Pass: Aggregate Filters\n// =======================================\n\n// =======================================\n// Web Audio\n// =======================================\n\n  class MicrophoneInput {\n    constructor() {\n      this._loaded = false;\n      this._sampleRate = 512;\n      this._isLive = false;\n      this._waveformSum = 0;\n      this._waveformSumMax = 4096 * 10;\n      this._gain = 1.0; // technically logarithmic ¯\\_(ツ)_/¯\n    }\n\n    initMic(audioContext, cb) {\n      this._context = audioContext;\n      navigator.mediaDevices.getUserMedia({audio: true})\n        .then(cb)\n        .catch(this.initMicError);\n    }\n\n    initMicGraph(stream) {\n      var micInput = this._context.createMediaStreamSource(stream);\n      // TODO: create context.createAnalyser() node if FFT is needed\n      var scriptProcessor = this._context.createScriptProcessor(this._sampleRate, 1, 1);\n\n      var thisMic = this;\n      scriptProcessor.onaudioprocess = function(event) {\n        var inputData = event.inputBuffer.getChannelData(0); // mono :(\n        var waveformSum = 0;\n        for (i=0; i < thisMic._sampleRate; i++) {\n          waveformSum += thisMic._gain * Math.abs(inputData[i]);\n        }\n        thisMic.updateMicUniform(waveformSum);\n      };\n\n      micInput.connect(scriptProcessor);\n      scriptProcessor.connect(this._context.destination);\n      this._loaded = true;\n    }\n\n    initMicError(e) {\n      console.error('Error initializing microphone', e);\n    }\n\n    updateMicUniform(waveformSum) {\n      this._waveformSum += waveformSum % this._waveformSumMax;\n    }\n\n    getColorShift(rPeriod,gPeriod,bPeriod) {\n      // r g b: the frequencies to modulate\n      return vec3.fromValues(\n        (this._waveformSum % rPeriod) / rPeriod,\n        (this._waveformSum % gPeriod) / gPeriod,\n        (this._waveformSum % bPeriod) / bPeriod);\n    }\n\n    enableControls() {\n      var enabledCheckbox = document.getElementById('audio-color-shift-enabled');\n      enabledCheckbox.checked = true;\n      enabledCheckbox.enabled = true;\n    }\n  }\n\n  var audioContext = new window.AudioContext();\n  var mic = new MicrophoneInput();\n\n  window.activateMic = function() {\n    setTimeout(function() {\n      mic.initMic(audioContext, function (stream) {\n        mic.enableControls();\n        mic.initMicGraph(stream);\n        mic.isLive = true;\n        document.getElementById('btn-activate-mic').className = \"btn btn-danger navbar-btn\";\n      });\n    }, 250);\n  };\n\n// =======================================\n// Plot Scalar Values\n// =======================================\n\n  var numDataPoints = 50;\n\n  function hexColorToVec4(hex) {\n    return vec4.fromValues(\n      parseInt(hex.substr(0,2), 16) / 255,\n      parseInt(hex.substr(2,2), 16) / 255,\n      parseInt(hex.substr(4,2), 16) / 255,\n      1.0\n    );\n  }\n\n  var bsPrimary = hexColorToVec4(\"337ab7\"),\n    bsSuccess = hexColorToVec4(\"5cb85c\"),\n    bsInfo = hexColorToVec4(\"5bc0de\"),\n    bsWarning = hexColorToVec4(\"f0ad4e\"),\n    bsDanger = hexColorToVec4(\"d9534f\");\n\n  var linePlots = {\n    momentum: {\n      plot: new LinePlot(gl, numDataPoints, {\n        program: programLinePlot,\n        transformProgram: programLinePlotTransform,\n        lineColor: bsPrimary,\n        lineWidth: 10,\n        max: { value: 1, dynamic: true, expiresAfter: 500 },\n        min: { value: 0, dynamic: true, expiresAfter: 500 }\n      }),\n      enabled: false,\n      buttonClass: 'btn btn-info navbar-btn'\n    },\n    force: {\n      plot: new LinePlot(gl, numDataPoints, {\n        program: programLinePlot,\n        transformProgram: programLinePlotTransform,\n        lineColor: bsSuccess,\n        lineWidth: 10,\n        max: { value: 1, dynamic: true, expiresAfter: 500 },\n        min: { value: 0, dynamic: true, expiresAfter: 500 }\n      }),\n      enabled: false,\n      buttonClass: 'btn btn-success navbar-btn'\n    },\n    fps: {\n      plot: new LinePlot(gl, numDataPoints, {\n        program: programLinePlot,\n        transformProgram: programLinePlotTransform,\n        lineColor: bsDanger,\n        lineWidth: 10,\n        max: { value: 1, dynamic: true, expiresAfter: 500 },\n        min: { value: 0, dynamic: false, expiresAfter: 500 }\n      }),\n      enabled: false,\n      buttonClass: 'btn btn-danger navbar-btn'\n    }\n  };\n\n// =======================================\n// UI Controls\n// =======================================\n\n  var particleCount, particleSpeed;\n  var fieldSize, fieldMinFactor, rCoefficient, maxFieldLines;\n  var renderTexture, physicsMethod;\n  var paused = false;\n\n  var physicsMethods = {\n    brownian: 0,\n    splat: 1,\n    field: 2\n  };\n\n  var spaceType = 0;\n  var spaceTypes = {\n    finite: 0,\n    wrapped: 1,\n    infinite: 2\n  };\n\n  var fractRenderValues, renderMagnitude, forceCalcInGlPointSpace;\n\n  var scaleRenderValues, circularFieldEffect, deferGradientCalc;\n  var resetParticles = false, resetParticlesWith = 'random';\n\n  window.setResetParticles = function() {\n    resetParticles = true;\n  };\n\n  window.setResetParticlesWith = function(k) {\n    resetParticlesWith = k;\n  };\n\n  var particleResetVectorFields = {\n    random: function(x,y) {\n      return new Float32Array([2 * Math.random() - 1.0, 2 * Math.random() - 1.0, 0, 0]);\n    },\n    zero: function(x,y) {\n      return new Float32Array([0,0,0,0]);\n    },\n    outward: function(x,y) {\n      return new Float32Array([x, y, 0, 0]);\n    },\n    inward: function(x,y) {\n      return new Float32Array([-x, -y, 0, 0]);\n    },\n    'right-vortex': function(x,y) {\n      return new Float32Array([y, -x, 0, 0]);\n    },\n    'left-vortex': function(x,y) {\n      return new Float32Array([-y, x, 0, 0]);\n    },\n    'merger': function(x,y) {\n      return new Float32Array([-y, -x, 0, 0]);\n    },\n    'vector-field-xy-x': function(x,y) {\n      return new Float32Array([x * y, -x, 0, 0]);\n    },\n    'vector-field-y-xy': function(x,y) {\n      return new Float32Array([y * x, y, 0, 0]);\n    }\n  };\n\n  var audioColorShift = vec3.fromValues(0.0, 0.0, 0.0),\n    audioColorShiftGain = 1.0,\n    audioColorShiftEnabled = false;\n\n  function getUIElemements() {\n    var ui = {\n      particleCount: document.getElementById('particle-count'),\n      particleSpeed: document.getElementById('particle-speed'),\n      rCoefficient: document.getElementById('r-coefficient'),\n      fieldSize: document.getElementById('field-size'),\n      fieldMinFactor: document.getElementById('field-min-factor'),\n      maxFieldLines: document.getElementById('max-field-lines'),\n\n      scaleForceToSpace: document.getElementById('scale-force-to-space'),\n      circularFieldEffect: document.getElementById('circular-field-effect'),\n      deferGradientCalc: document.getElementById('defer-gradient-calc'),\n\n      fractRenderValues: document.getElementById('fract-render-values'),\n      scaleRenderValues: document.getElementById('scale-render-values'),\n      renderMagnitude: document.getElementById('render-magnitude'),\n\n      audioColorShift: {\n        gain: document.getElementById('audio-color-shift-gain'),\n        enabled: document.getElementById('audio-color-shift-enabled'),\n        r: document.getElementById('audio-color-shift-r'),\n        g: document.getElementById('audio-color-shift-g'),\n        b: document.getElementById('audio-color-shift-b')\n      },\n\n      spaceType: document.getElementsByName('space-type'),\n      renderTexture: document.getElementsByName('render-texture'),\n      physicsMethod: document.getElementsByName('physics-method'),\n      togglePlot: {\n        momentum: document.getElementById('toggle-plot-momentum'),\n        force: document.getElementById('toggle-plot-force'),\n        fps: document.getElementById('toggle-plot-fps')\n      }\n    };\n\n    return ui;\n  }\n\n  function uiControlUpdate(ui = {}) {\n    particleCount = ui.particleCount.value;\n    particleSpeed = ui.particleSpeed.value;\n    rCoefficient = ui.rCoefficient.value;\n    fieldSize = ui.fieldSize.value;\n    fieldMinFactor = ui.fieldMinFactor.value;\n    maxFieldLines = ui.maxFieldLines.value;\n\n    deferGradientCalc = ui.deferGradientCalc.checked;\n    fractRenderValues = ui.fractRenderValues.checked;\n    scaleRenderValues = ui.scaleRenderValues.checked;\n    renderMagnitude = ui.renderMagnitude.checked;\n    circularFieldEffect = ui.circularFieldEffect.checked;\n\n    forceCalcInGlPointSpace = !ui.scaleForceToSpace.checked;\n    if (forceCalcInGlPointSpace) {\n      rCoefficient /= 10;\n    }\n\n    audioColorShiftEnabled = ui.audioColorShift.enabled.checked;\n    audioColorShiftGain = ui.audioColorShift.gain.value;\n    audioColorShift = mic.getColorShift(\n      ui.audioColorShift.r.value,\n      ui.audioColorShift.g.value,\n      ui.audioColorShift.b.value);\n\n    var renderTextureRadios = ui.renderTexture;\n    renderTexture = [0,1,2].reduce((a,i) => renderTextureRadios[i].checked ? i : a, 0);\n\n    var physicsMethodRadios = ui.physicsMethod;\n    physicsMethod = [0,1,2].reduce((a,i) => physicsMethodRadios[i].checked ? i : a, 0);\n\n    var spaceTypeRadios = ui.spaceType;\n    spaceType = [0,1,2].reduce((a,i) => spaceTypeRadios[i].checked ? i : a, 0);\n\n    for (var k of ['momentum', 'fps']) {\n      linePlots[k].enabled = ui.togglePlot[k].checked;\n    }\n  }\n\n  window.togglePause = function() {\n    paused = !paused;\n    var pauseButton = document.getElementById('btn-play-pause');\n\n    if (paused) {\n      pauseButton.innerHTML = '<i class=\"fa fa-lg fa-play\">'\n    } else {\n      pauseButton.innerHTML = '<i class=\"fa fa-lg fa-pause\">'\n    }\n  };\n\n  // Yes, it's the worst two-way databinding ever\n  var configProfiles = {\n    defaults: function(ui = {}) {\n      ui.particleCount.value = 512;\n      ui.particleSpeed.value = 0.05;\n      ui.rCoefficient.value = 0.1;\n      ui.fieldSize.value = 75.0;\n      ui.fieldMinFactor = 3.0;\n      ui.maxFieldLines.value = 1.0;\n\n      ui.scaleForceToSpace.checked = false;\n      ui.circularFieldEffect.checked = true;\n      ui.deferGradientCalc.checked = false;\n\n      [ui.fractRenderValues, ui.scaleRenderValues, ui.renderMagnitude].forEach((el, i) => {\n        el.checked = false;\n        el.parentElement.classList.remove('active');\n      });\n\n      ui.spaceType.forEach((el, i) => {\n        el.checked = (i == 1);\n        if (el.checked) {\n          el.parentElement.classList.add('active');\n        } else {\n          el.parentElement.classList.remove('active');\n        }\n      });\n\n      ui.renderTexture.forEach((el, i) => {\n        el.checked = (i == 0);\n        if (el.checked) {\n          el.parentElement.classList.add('active');\n        } else {\n          el.parentElement.classList.remove('active');\n        }\n      });\n\n      ui.physicsMethod.forEach((el, i) => {\n        el.checked = (i == 0);\n        if (el.checked) {\n          el.parentElement.classList.add('active');\n        } else {\n          el.parentElement.classList.remove('active');\n        }\n      });\n    },\n\n    random: function(ui = {}) {\n      var randomFactor = function(range) {\n        return 1 + (range * Math.random() - range / 2.0);\n      };\n\n      var randomBoolean = function(chance = 0.5) {\n        return (Math.random() > chance);\n      };\n\n      var randomDataToggle = function(elemSet, pSet) {\n        var rand = Math.random();\n        for (var i = 0; i < elemSet.length; i++) {\n          elemSet[i].checked = (rand >= pSet[i] && rand < pSet[i+1]);\n          if (elemSet[i].checked) {\n            elemSet[i].parentElement.classList.add('active');\n          } else {\n            elemSet[i].parentElement.classList.remove('active');\n          }\n        }\n      };\n\n      ui.deferGradientCalc = false;\n      ui.rCoefficient.value = ui.rCoefficient.value * randomFactor(0.125);\n      ui.fieldSize.value = ui.fieldSize.value * randomFactor(0.125);\n      ui.fieldMinFactor.value = ui.fieldMinFactor * randomFactor(0.25);\n\n      ui.scaleRenderValues.checked = randomBoolean(0.1);\n      ui.circularFieldEffect.checked = randomBoolean(0.1);\n      ui.fractRenderValues.checked = randomBoolean(0.25);\n      ui.renderMagnitude.checked = randomBoolean(0.1);\n\n      [ui.fractRenderValues, ui.scaleRenderValues, ui.renderMagnitude].forEach((el, i) => {\n        if (el.checked) {\n          el.parentElement.classList.add('active');\n        } else {\n          el.parentElement.classList.remove('active');\n        }\n      });\n\n      if (ui.renderMagnitude.checked) {\n        ui.renderMagnitude.parentElement.classList.add('active');\n      } else {\n        ui.renderMagnitude.parentElement.classList.remove('active');\n      }\n\n      if (ui.fractRenderValues.checked) {\n        ui.maxFieldLines.value = Math.trunc((2/3)*ui.maxFieldLines.max * Math.random());\n      }\n\n      randomDataToggle(ui.renderTexture, [0.0, 0.15, 0.5, 1.0]);\n      randomDataToggle(ui.physicsMethod, [0.0, 0.45, 0.5, 1.0]);\n    }\n  };\n\n  window.activateProfile = function(k) {\n    var uiElements = getUIElemements();\n    configProfiles[k](uiElements);\n  };\n\n  var anyQuad = new Quad(gl);\n\n  gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n  gl.viewport(0, 0, renderResolution[0], renderResolution[1]);\n  gl.clearColor(0.0, 0.0, 0.0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n\n  var framecount = 0;\n\n  var startTime = Date.now(),\n    currentTime = startTime,\n    elapsedTime = currentTime - startTime,\n    simulationTime = elapsedTime,\n    lastAggregateTime = simulationTime,\n    lastFrameStart = currentTime,\n    lastFrameTime = currentTime - lastFrameStart;\n\n  var deltaT = vec4.fromValues(0.0,0.0,0.0,0.0);\n\n// =======================================\n// Debug Code\n// =======================================\n\n  var debugPixels = new Float32Array(renderResolution[0] * renderResolution[1] * 4);\n\n  function renderDebugTexture(pixels) {\n\n    gl.activeTexture(gl.TEXTURE0);\n    var debugTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, debugTexture);\n\n    gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA32F, renderResolution[0], renderResolution[1]);\n    gl.texSubImage2D(gl.TEXTURE_2D,\n      0,\n      0, // x offset\n      0, // y offset\n      renderResolution[0],\n      renderResolution[1],\n      gl.RGBA,\n      gl.FLOAT,\n      pixels);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n  }\n\n// =======================================\n// Render Loop\n// =======================================\n\n  function render() {\n    framecount++;\n    updateTime();\n\n    deltaT = updateDeltaT(deltaT, lastFrameTime);\n    var uiElements = getUIElemements();\n    uiControlUpdate(uiElements);\n\n    if (resetParticles) {\n      var newPositions = generateFloat32Randoms(particleResolution[0], particleResolution[1], 4, -0.5, 0.5);\n\n      gl.activeTexture(gl.TEXTURE0);\n      gl.bindTexture(gl.TEXTURE_2D, particlePonger.getCurrent('particles'));\n      gl.texSubImage2D(gl.TEXTURE_2D,\n        0,\n        0, // x offset\n        0, // y offset\n        particleResolution[0],\n        particleResolution[1],\n        gl.RGBA,\n        gl.FLOAT,\n        newPositions);\n\n      var newParticleMomentums = new Float32Array(particleResolution[0] * particleResolution [1] * 4);\n      for (var i = 0; i < newParticleMomentums.length; i += 4) {\n        newParticleMomentums.set(particleResetVectorFields[resetParticlesWith](newPositions[i], newPositions[i+1]), i);\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, particlePonger.getCurrent('particleMomentums'));\n      gl.texSubImage2D(gl.TEXTURE_2D,\n        0,\n        0, // x offset\n        0, // y offset\n        particleResolution[0],\n        particleResolution[1],\n        gl.RGBA,\n        gl.FLOAT,\n        newParticleMomentums);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n\n      resetParticles = false;\n    }\n\n    if (!paused) {\n\n      if (physicsMethod == physicsMethods.splat) {\n        var forceSplatUniforms = {\n          resolution: particleResolution,\n          rCoefficient: rCoefficient,\n          particleIdLimit: particleCount\n        };\n\n        rpForceSplat.encode(gl, forceSplatUniforms, {\n          framebuffer: forceSplatFbo,\n          particles: particlePonger.getCurrent('particles'),\n          particleCount: particleCount\n        });\n      }\n\n      var particleUniforms = {\n        resolution: particleResolution,\n        fieldResolution: renderResolution,\n        randomSeed: makeIntRandomUniforms(),\n        particleSpeed: particleSpeed,\n        deltaTime: deltaT,\n        physicsMethod: physicsMethod,\n        spaceType: spaceType\n      };\n\n      rpParticles.encode(gl, particleUniforms, {\n        framebuffer: particlePonger.getCurrentFbo(),\n        particleRandoms: particlePonger.getCurrent('particleRandoms'),\n        particles: particlePonger.getCurrent('particles'),\n        particleMomentums: particlePonger.getCurrent('particleMomentums'),\n        particleForceSplat: forceSplatTexture,\n        repelField: fieldPonger.getCurrent('repelField')\n      });\n\n      particlePonger.increment();\n\n    }\n\n    var fieldsUniforms = {\n      resolution: renderResolution,\n      fieldSize: fieldSize,\n      rCoefficient: rCoefficient,\n      deferGradientCalc: deferGradientCalc,\n      circularFieldEffect: circularFieldEffect,\n      forceCalcInGlPointSpace: forceCalcInGlPointSpace,\n      fieldMinFactor: fieldMinFactor\n    };\n\n    rpFields.encode(gl, fieldsUniforms, {\n      framebuffer: fieldPonger.getCurrentFbo(),\n      particles: particlePonger.getCurrent('particles'),\n      particleCount: particleCount\n    });\n\n    fieldPonger.increment();\n\n    var gradientTexture;\n    if (deferGradientCalc) {\n      var gradientsUniforms = {\n        resolution: renderResolution\n      };\n\n      rpGradients.encode(gl, gradientsUniforms, {\n        framebuffer: gradientPonger.getCurrentFbo(),\n        repelField: fieldPonger.getCurrent('repelField')\n      });\n\n      gradientTexture = gradientPonger.getNext('repelFieldGradient');\n    } else {\n      gradientTexture = fieldPonger.getCurrent('repelFieldGradient');\n    }\n    gradientPonger.increment();\n\n    var renderFieldsUniforms = {\n      resolution: renderResolution,\n      rCoefficient: rCoefficient,\n      fractRenderValues: fractRenderValues,\n      scaleRenderValues: scaleRenderValues,\n      renderMagnitude: renderMagnitude,\n      maxFieldLines: maxFieldLines,\n      renderTexture: renderTexture,\n      audioColorShiftEnabled: audioColorShiftEnabled,\n      audioColorShift: audioColorShift\n    };\n\n    var renderFieldsOptions = {\n      framebuffer: null,\n      repelField: fieldPonger.getCurrent('repelField'),\n      repelFieldGradient: gradientTexture\n    };\n\n    rpRenderFields.encode(gl, renderFieldsUniforms, renderFieldsOptions);\n\n    // update aggregate values & line plots\n    if (!paused) {\n      if (simulationTime - lastAggregateTime > 100) {\n\n        var reducedAggregates = mipReducer.reduce(gl, {}, {\n          MomentumSum: particlePonger.getCurrent('particles'),\n          MomentumMinMax: particlePonger.getCurrent('particles'),\n          quad: anyQuad\n        });\n\n        var instantaneousFps = 1000 / deltaT[0];\n        var averageMomentum = reducedAggregates['MomentumSum'][2];\n\n        document.getElementById('stats-fps-label').innerText = `${Math.trunc(instantaneousFps)} FPS`;\n\n        linePlots['momentum'].plot.push([simulationTime, averageMomentum]);\n        //linePlots['force'].plot.push([simulationTime, Math.random()/2]);\n        linePlots['fps'].plot.push([simulationTime, instantaneousFps]);\n      }\n    }\n\n    for (var k of Object.keys(linePlots)) {\n      if (linePlots[k].enabled) {\n        linePlots[k].plot.encodeTransform(gl, {\n          resolution: renderResolution\n        });\n        linePlots[k].plot.encode(gl, {\n          resolution: renderResolution,\n          beforeEncode: (context, plot) => {\n            context.bindFramebuffer(context.DRAW_FRAMEBUFFER, null);\n            context.blendFunc(context.ONE, context.ZERO);\n          }\n        })\n      }\n    }\n\n    requestAnimationFrame(render);\n  }\n\n  render();\n}\n\nwindow.onload = function() {\n  AniPlatform.fixCanvasUIBar(...['main-canvas-container', 'main-canvas', 'canvas-ui-bar-bottom'].map(id => document.getElementById(id)));\n  runWebGL();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./es6/main.js","// performed once every n frames\n// (1) on particle qi/pi update shader\n// - attach a render buffer and render when indicated by uniforms\n//   - essentially render a copy of the qi/pi data\n// (2) blit into MipReducer pipeline\n// - mip reducer will have two framebuffers to ping pong data from a renderbuffer\n//   - unless this can be done on a single framebuffer\n// (3) finally the data is aggregated to a level of diminishing returns\n// - at this point, readPixels or a transform feedback call (yuck) can push\n//   the data to a buffer or an array of floats\n// - CPU binds to data point on LinePlot\n\n// https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/glFramebufferRenderbuffer.xhtml\n// - https://www.khronos.org/opengl/wiki/Framebuffer\n//   - (source & destination can bee the same)\n//   - at least in OpenGL\n\nclass MipReducerAttachment {\n  constructor(attr) {\n    this._id = attr.id;\n    this._defaultValue = attr.defaultValue;\n    this._internalFormat = attr.internalFormat;\n    this._init = attr.init;\n    this._calc = attr.calc;\n    this._write = attr.write;\n\n    this._textures = [];\n  }\n\n  get id() { return this._id; }\n  get defaultValue() { return this._defaultValue; }\n  get internalFormat() { return this._internalFormat; }\n  get init() { return this._init; }\n  get calc() { return this._calc; }\n  get write() { return this._write; }\n\n  get textures() { return this._textures; }\n  set textures(textures) { this._textures = textures; }\n\n  addTexture(texture) {\n    this._textures.push(texture);\n  }\n}\n\nclass MipReducer {\n  constructor(resolution, attachments, options = {}) {\n    this._resolution = resolution;\n    this._requiredUniforms = ['u_iteration', 'u_readOffset', 'u_readSize', 'u_writeOffset', 'u_writeSize'];\n\n    var logX = Math.log2(this._resolution[0]),\n      logY = Math.log2(this._resolution[1]);\n\n    this._levels = (logX > logY ? Math.trunc(logX) + 1 : Math.trunc(logY) + 1);\n    this._mipmaps = this.generateMipmaps(this._resolution, this._levels);\n    this._attachments = attachments;\n    this._values = {};\n    this._pingpongId = 0;\n\n    this._uniforms = options.uniforms || {};\n  }\n\n  configure(context, options = {}) {\n    this.createTextures(context);\n    this.createFramebuffers(context);\n    this.configureProgram(context);\n    this.configureUniforms(context, options);\n\n    this._samplerNearest = context.createSampler();\n    context.samplerParameteri(this._samplerNearest, context.TEXTURE_MIN_FILTER, context.NEAREST);\n    context.samplerParameteri(this._samplerNearest, context.TEXTURE_MAG_FILTER, context.NEAREST);\n    context.samplerParameteri(this._samplerNearest, context.TEXTURE_WRAP_S, context.CLAMP_TO_EDGE);\n    context.samplerParameteri(this._samplerNearest, context.TEXTURE_WRAP_T, context.CLAMP_TO_EDGE);\n  }\n\n  createTextures(context) {\n    for (var attach of this._attachments) {\n      context.activeTexture(context.TEXTURE0);\n      var tex = context.createTexture();\n      context.bindTexture(context.TEXTURE_2D, tex);\n      context.texStorage2D(context.TEXTURE_2D, 1, attach.internalFormat, this._resolution[0], this._resolution[1]);\n      context.bindTexture(context.TEXTURE_2D, null);\n      attach.addTexture(tex);\n\n      context.activeTexture(context.TEXTURE0);\n      var tex = context.createTexture();\n      context.bindTexture(context.TEXTURE_2D, tex);\n      context.texStorage2D(context.TEXTURE_2D, 1, attach.internalFormat, this._resolution[0], this._resolution[1]);\n      context.bindTexture(context.TEXTURE_2D, null);\n      attach.addTexture(tex);\n    }\n  }\n\n  createFramebuffers(context) {\n    this._framebuffers = [context.createFramebuffer(), context.createFramebuffer()];\n\n    for (var i = 0; i < this._framebuffers.length; i++) {\n      var fbo = this._framebuffers[i];\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, fbo);\n\n      for (var j = 0; j < this._attachments.length; j++) {\n        var attach = this._attachments[j];\n        var tex = attach.textures[(i+1) % 2];\n        context.framebufferTexture2D(context.DRAW_FRAMEBUFFER, context[`COLOR_ATTACHMENT${j}`], context.TEXTURE_2D, tex, 0);\n      }\n\n      this.checkFboStatus(context);\n      context.clearColor(0.0,0.0,0.0,0.0);\n      context.clear(context.COLOR_BUFFER_BIT);\n      context.bindFramebuffer(context.DRAW_FRAMEBUFFER, null);\n    }\n  }\n\n  generateMipmaps(resolution, levels) {\n    var firstLevel = {\n      pos: vec2.fromValues(0,0),\n      res: vec2.fromValues(Math.ceil(resolution[0] / 2), Math.ceil(resolution[1] / 2))\n    };\n\n    return new Int32Array(levels - 1).reduce((mips, level, i) => {\n      var pos = vec2.create(), res;\n      if (i % 2 == 0) {\n        vec2.add(pos, mips[i].pos, vec2.fromValues(mips[i].res[0], 0));\n      } else {\n        vec2.add(pos, mips[i].pos, vec2.fromValues(0, mips[i].res[1]));\n      }\n\n      // each level is half the size\n      res = vec2.fromValues(\n        Math.ceil(mips[i].res[0] / 2),\n        Math.ceil(mips[i].res[1] / 2)); // Math.round is incorrect for non-power-of-two\n\n      mips[i+1] = { pos: pos, res: res };\n      return mips\n    }, [firstLevel]);\n  }\n\n  checkFboStatus(context) {\n    var status = context.checkFramebufferStatus(context.DRAW_FRAMEBUFFER);\n    if (status != context.FRAMEBUFFER_COMPLETE) {\n      console.error('fb status: ' + status.toString(10));\n    }\n  }\n\n  fragmentShaderSymbols() {\n    return {\n      sampler: function (attachment, i) {\n        return `s_attachment${attachment.id || i}`\n      },\n      default: function(attachment, i) {\n        return `u_attachment${attachment.id || i}Default`\n      },\n      texels: function (attachment, i) {\n        return `attachment${attachment.id || i}Texels`;\n      },\n      output: function (attachment, i) {\n        return `o_attachment${attachment.id || i}`\n      }\n    }\n  };\n\n  generateFragmentShaderSource() {\n    var symbols = this.fragmentShaderSymbols();\n\n    var varyings = `\n    in vec4 v_position;\n    in vec2 v_st;\n    `;\n\n    var uniforms = `\n    uniform int u_iteration;\n    uniform ivec2 u_readOffset;\n    uniform ivec2 u_readSize;\n    uniform ivec2 u_writeOffset;\n    uniform ivec2 u_writeSize;\n    `;\n\n    var additionalUniforms = Object.keys(this._uniforms).map((k) => {\n      return `uniform ${this._uniforms[k]} ${k};`;\n    }).join(\"\\n\");\n\n    var samplerUniforms = this._attachments.map((attach, i) => {\n      var attachSampler = symbols.sampler(attach, i);\n      var attachDefault = symbols.default(attach, i);\n\n      return `\n      uniform sampler2D ${attachSampler};\n      uniform vec4 ${attachDefault};\n      `\n    }).join(\"\\n\");\n\n    var attachmentOuts = this._attachments.map((attach, i) => {\n      var attachOutput = symbols.output(attach, i);\n\n      return `layout(location = ${i}) out vec4 ${attachOutput};`\n    }).join(\"\\n\");\n\n    var constructTexelCoords = `\n    ivec2 writeUv = ivec2(trunc(gl_FragCoord.xy)) - u_writeOffset;\n    ivec2 readUv = u_readOffset + writeUv * 2;\n    bvec2 singleFetch;\n    `;\n\n    var readAttachments = this._attachments.map((attach, i) => {\n      var texels = symbols.texels(attach, i);\n      var sampler = symbols.sampler(attach, i);\n      var defaultValue = symbols.default(attach, i);\n\n      return `\n      vec4 ${texels}[4];\n\n      singleFetch = equal(readUv + ivec2(1,1), u_readOffset + u_readSize);\n      ${texels}[0] = texelFetch(${sampler}, readUv, 0);\n      ${texels}[1] = singleFetch.x ? ${defaultValue} : texelFetch(${sampler}, readUv + ivec2(1,0), 0);\n      ${texels}[2] = singleFetch.y ? ${defaultValue} : texelFetch(${sampler}, readUv + ivec2(0,1), 0);\n      ${texels}[3] = any(singleFetch.xy) ? ${defaultValue} : texelFetch(${sampler}, readUv + ivec2(1,1), 0);\n      `;\n    }).join(\"\\n\");\n\n    var initAttachments = this._attachments.map((attach, i) => {\n      var texels = symbols.texels(attach, i);\n      var sampler = symbols.sampler(attach, i);\n      var defaultValue = symbols.default(attach, i);\n\n      if (attach.init) {\n        return eval(\"`\" + attach.init + \"`\");\n      } else {\n        return \"\\n\";\n      }\n    }).join(\"\\n\");\n\n    var calcAttachments = this._attachments.map((attach, i) => {\n      var texels = symbols.texels(attach, i);\n      var sampler = symbols.sampler(attach, i);\n      var defaultValue = symbols.default(attach, i);\n\n      if (attach.calc) {\n        return eval(\"`\" + attach.calc + \"`\");\n      } else {\n        return \"\\n\"\n      }\n    }).join(\"\\n\");\n\n    var writeAttachments = this._attachments.map((attach, i) => {\n      var attachOutput = symbols.output(attach, i);\n      var texels = symbols.texels(attach, i);\n\n      return attachOutput + \" = \" + eval(\"`\" + attach.write + \"`\");\n    }).join(\"\\n\");\n\n    return `\n    ${varyings}\n    ${uniforms}\n    ${additionalUniforms}\n    ${samplerUniforms}\n    ${attachmentOuts}\n\n    void main() {\n\n    ${constructTexelCoords}\n    ${readAttachments}\n    if (u_iteration == -1) {\n      ${initAttachments}\n    }\n    ${calcAttachments}\n    ${writeAttachments}\n\n    }`;\n  }\n\n  configureProgram(context) {\n    var prefix = `#version 300 es\n    #extension EXT_color_buffer_float : enable\n    `;\n\n    var precision = `\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    precision highp usampler2D;\n    precision highp isampler2D;\n    `;\n\n    var vsPassSource = `\n    layout(location = 0) in vec3 a_position;\n    layout(location = 1) in vec2 a_texcoord;\n    out vec2 v_st;\n    out vec4 v_position;\n    void main() {\n      v_st = a_texcoord;\n      v_position = vec4(a_position, 1.0);\n      gl_Position = v_position;\n    }\n    `;\n\n    var program = context.createProgram();\n    var vertexShaderSource = prefix + precision + vsPassSource;\n    var fragmentShaderSource = prefix + precision + this.generateFragmentShaderSource();\n\n    var vshader = context.createShader(context.VERTEX_SHADER);\n    context.shaderSource(vshader, vertexShaderSource);\n    context.compileShader(vshader);\n\n    var fshader = context.createShader(context.FRAGMENT_SHADER);\n    context.shaderSource(fshader, fragmentShaderSource);\n    context.compileShader(fshader);\n\n    context.attachShader(program, vshader);\n    context.attachShader(program, fshader);\n    context.linkProgram(program);\n\n    var log = context.getProgramInfoLog(program);\n    if (log) {\n      console.log(log);\n    }\n\n    log = context.getShaderInfoLog(vshader);\n    if (log) {\n      console.log(log);\n    }\n\n    log = context.getShaderInfoLog(fshader);\n    if (log) {\n      console.log(log);\n    }\n\n    this._program = program;\n  }\n\n  configureUniforms(context, options) {\n    var symbols = this.fragmentShaderSymbols();\n\n    var uniforms = this._requiredUniforms.concat(options.uniforms || []);\n    this._uniformLocations = uniforms.reduce((acc, name) => {\n      acc[name] = context.getUniformLocation(this._program, name);\n      return acc;\n    }, {});\n\n    for (var i = 0; i < this._attachments.length; i++ ) {\n      var attach = this._attachments[i];\n      attach.samplerName = symbols.sampler(attach, i);\n      attach.samplerDefault = symbols.default(attach, i);\n      attach.samplerUniformLocation = context.getUniformLocation(this._program, attach.samplerName);\n      attach.samplerDefaultUniformLocation = context.getUniformLocation(this._program, attach.samplerDefault)\n    }\n  }\n\n  encodeLevel(context, iteration, uniforms, ops = {}) {\n    context.bindFramebuffer(context.DRAW_FRAMEBUFFER, this._framebuffers[this._pingpongId]);\n    context.blendFunc(context.ONE, context.ZERO);\n\n    context.uniform1i(this._uniformLocations.u_iteration, iteration);\n    var readOffset, readSize;\n    if (iteration == -1) {\n      readOffset = [0,0];\n      readSize = [this._resolution[0], this._resolution[1]];\n    } else {\n      readOffset = [this._mipmaps[iteration].pos[0], this._mipmaps[iteration].pos[1]];\n      readSize = [this._mipmaps[iteration].res[0], this._mipmaps[iteration].res[1]];\n    }\n    // chrome doesn't allow uniform2iv to be submitted with Float32Array =/\n    context.uniform2iv(this._uniformLocations.u_readOffset, readOffset);\n    context.uniform2iv(this._uniformLocations.u_readSize, readSize);\n\n    var writeOffset = [this._mipmaps[iteration+1].pos[0],  this._mipmaps[iteration+1].pos[1]];\n    var writeSize = [this._mipmaps[iteration+1].res[0],  this._mipmaps[iteration+1].res[1]];\n    context.uniform2iv(this._uniformLocations.u_writeOffset, writeOffset);\n    context.uniform2iv(this._uniformLocations.u_writeSize, writeSize);\n\n    context.viewport(\n      this._mipmaps[iteration+1].pos[0],\n      this._mipmaps[iteration+1].pos[1],\n      this._mipmaps[iteration+1].res[0],\n      this._mipmaps[iteration+1].res[1]);\n\n  }\n\n  encodeTextures(context, iteration, uniforms, ops = {}) {\n    for (var i = 0; i < this._attachments.length; i++) {\n      var attach = this._attachments[i];\n      var texture;\n      if (iteration == -1) {\n        texture = ops[attach.id]\n      } else {\n        texture = attach.textures[this._pingpongId];\n      }\n      context.activeTexture(context[`TEXTURE${i}`]);\n      context.uniform1i(attach.samplerUniformLocation, i);\n      context.uniform4fv(attach.samplerDefaultUniformLocation, attach.defaultValue);\n      context.bindTexture(context.TEXTURE_2D, texture);\n      context.bindSampler(i, this._samplerNearest);\n    }\n  }\n\n  encodeDraw(context, uniforms, ops) {\n    context.drawBuffers(this._attachments.map((attach, i) => context[`COLOR_ATTACHMENT${i}`]));\n\n    context.bindVertexArray(ops.quad.vertexArray);\n    context.drawArrays(context.TRIANGLES, 0, 6);\n\n    this.incrementPingpong();\n  }\n\n  reduce(context, uniforms, ops = {}) {\n    context.useProgram(this._program);\n\n    this._pingpongId = 0;\n    this.encodeLevel(context, -1, uniforms, ops);\n    this.encodeTextures(context, -1, uniforms, ops);\n\n    this.checkFboStatus(context);\n    this.encodeDraw(context, uniforms, ops);\n\n    for (var i = 0; i < this._levels - 1; i++) {\n      this.encodeLevel(context, i, uniforms, ops);\n      this.encodeTextures(context, i, uniforms, ops);\n\n      this.checkFboStatus(context);\n      this.encodeDraw(context, uniforms, ops);\n    }\n\n    context.bindFramebuffer(context.READ_FRAMEBUFFER, this._framebuffers[(this._pingpongId + 1) % 2]);\n\n    this._values = this._attachments.reduce((acc, attach, i) => {\n      var pixels = new Float32Array(4);\n      var mipmap = this._mipmaps[this._mipmaps.length - 1];\n      context.readBuffer(context[`COLOR_ATTACHMENT${i}`]);\n      context.readPixels(mipmap.pos[0], mipmap.pos[1], 1, 1, context.RGBA, context.FLOAT, pixels);\n      acc[attach.id] = pixels;\n      return acc\n    }, {});\n\n    return this._values;\n    // TODO: callback?\n  }\n\n\n  incrementPingpong() {\n    this._pingpongId = (this._pingpongId + 1) % 2;\n  }\n}\n\nexport { MipReducer, MipReducerAttachment };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/MipReducer.js\n// module id = 1\n// module chunks = 0","class Quad {\n  constructor(context) {\n    this._pos = this.getQuadPositions();\n    this._tex = this.getQuadTexCoords();\n\n    this._buffers = this.prepareBuffers(context, this._pos, this._tex);\n    this._vertexArray = this.prepareVertexArray(context, this._buffers);\n  }\n\n  get pos() {\n    return this._pos;\n  }\n\n  set pos(pos) {\n    this._pos = pos\n  }\n\n  get tex() {\n    return this._tex;\n  }\n\n  set tex(tex) {\n    this._tex = tex;\n  }\n\n  get buffers() {\n    return this._buffer;\n  }\n\n  set buffers(buffer) {\n    this._buffer = buffer;\n  }\n\n  get vertexArray() {\n    return this._vertexArray;\n  }\n\n  set vertexArray(vertexArray) {\n    this._vertexArray = vertexArray;\n  }\n\n  prepareBuffers(context, pos, tex) {\n    var vertexPosBuffer = context.createBuffer();\n    context.bindBuffer(context.ARRAY_BUFFER, vertexPosBuffer);\n    context.bufferData(context.ARRAY_BUFFER, pos, context.STATIC_DRAW);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    var vertexTexBuffer = context.createBuffer();\n    context.bindBuffer(context.ARRAY_BUFFER, vertexTexBuffer);\n    context.bufferData(context.ARRAY_BUFFER, tex, context.STATIC_DRAW);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    return {\n      pos: vertexPosBuffer,\n      tex: vertexTexBuffer\n    }\n  }\n\n  prepareVertexArray(context, buffers) {\n    var vertexArray = context.createVertexArray();\n    context.bindVertexArray(vertexArray);\n\n    var vertexPosIdx = 0;\n    context.bindBuffer(context.ARRAY_BUFFER, buffers.pos);\n    context.vertexAttribPointer(vertexPosIdx, 4, context.FLOAT, false, 0, 0);\n    context.enableVertexAttribArray(vertexPosIdx);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    var vertexTexIdx = 1;\n    context.bindBuffer(context.ARRAY_BUFFER, buffers.tex);\n    context.vertexAttribPointer(vertexTexIdx, 2, context.FLOAT, false, 0, 0);\n    context.enableVertexAttribArray(vertexTexIdx);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    context.bindVertexArray(null);\n\n    return vertexArray;\n  }\n\n  createVertexLayout() {\n    // TODO: given a hash config, return new vertex layout using these buffers\n  }\n\n  getQuadPositions() {\n    return new Float32Array([\n      -1.0, -1.0, 0.0, 1.0,\n      1.0, -1.0, 0.0, 1.0,\n      1.0, 1.0, 0.0, 1.0,\n      1.0, 1.0, 0.0, 1.0,\n      -1.0, 1.0, 0.0, 1.0,\n      -1.0, -1.0, 0.0, 1.0\n    ])\n  }\n\n  getQuadTexCoords() {\n    return new Float32Array([\n      0.0, 0.0,\n      1.0, 0.0,\n      1.0, 1.0,\n      1.0, 1.0,\n      0.0, 1.0,\n      0.0, 0.0\n    ])\n  }\n}\n\nexport { Quad };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/Quad.js\n// module id = 2\n// module chunks = 0","class LinePlot {\n  constructor(context, size, options = {}) {\n    this._size = size;\n    this._rolling = options.rolling ? true : false;\n    this._currentIndex = size - 1;\n\n    this._lineColor = options.lineColor || vec4.fromValues(1.0, 1.0, 1.0, 1.0);\n    this._lineWidth = options.lineWidth || 10;\n\n    this._pos = new Float32Array(size * 2);\n    this._max = options.max || { value: 1, dynamic: false };\n    this._min = options.min || { value: 0, dynamic: false };\n\n    if (this._max.dynamic) {\n      this._max.index = 0;\n      this._max.age = 0;\n      this._max.expiresAfter = options.max.expiresAfter || this._size;\n    }\n    if (this._min.dynamic) {\n      this._min.index = 0;\n      this._min.age = 0;\n      this._min.expiresAfter = options.min.expiresAfter || this._size;\n    }\n\n    this._buffers = this.prepareBuffers(context, this._pos);\n    this._vertexArray = this.prepareVertexArray(context, this._buffers);\n\n    this._program = options.program;\n    this.setUniformLocations(context);\n\n    this._transformProgram = options.transformProgram;\n    this._transformFeedback = context.createTransformFeedback();\n    this._transformVertexArray = this.prepareTransformVertexArray(context, this._buffers);\n    this._transformUniformLocations = {};\n    this.setTransformUniformLocations(context);\n\n    this._drawVertexArray = this.prepareDrawVertexArray(context, this._buffers);\n  }\n\n  getDataPoint(n) {\n    return [\n      this._pos[n * 2],\n      this._pos[n * 2 + 1]\n    ];\n  }\n\n  setDataPoint(n, d) {\n    this._pos[n * 2] = d[0];\n    this._pos[n * 2 + 1] = d[1];\n  }\n\n  get pos() { return this._pos; }\n  set pos(pos) { this._pos = pos; }\n  get buffers() { return this._buffers; }\n  set buffers(buffers) { this._buffers = buffers; }\n  get vertexArray() { return this._vertexArray; }\n  set vertexArray(vertexArray) { this._vertexArray = vertexArray; }\n\n  get program() { return this._program; }\n  set program(program) { this._program = program; }\n  get transformProgram() { return this._transformProgram; }\n  set transformProgram(transformProgram) { this._transformProgram = transformProgram; }\n\n  get uniformLocations() { return this._uniformLocations; }\n  get transformUniformLocations() { return this._transformUniformLocations; }\n\n  setUniformLocations(context) {\n    this._uniformLocations = {\n      u_lineColor: context.getUniformLocation(this._program, 'u_lineColor')\n    }\n  }\n\n  setTransformUniformLocations(context) {\n    this._transformUniformLocations = {\n      u_lineWidth: context.getUniformLocation(this._transformProgram, 'u_lineWidth'),\n      u_projection: context.getUniformLocation(this._transformProgram, 'u_projection')\n    }\n  }\n\n  encodeTransform(context, options = {}) {\n    // update data in buffers\n    this.writeBuffers(context);\n\n    context.enable(context.RASTERIZER_DISCARD);\n    context.bindTransformFeedback(context.TRANSFORM_FEEDBACK, this._transformFeedback);\n    context.useProgram(this._transformProgram);\n    context.bindBufferBase(context.TRANSFORM_FEEDBACK_BUFFER, 0, this._buffers.posTransformed);\n    context.bindVertexArray(this._vertexArray);\n\n    var scaledWidth = this._lineWidth / options.resolution[1];\n    context.uniform1f(this._transformUniformLocations.u_lineWidth, scaledWidth); // scale for resolution\n    context.uniformMatrix4fv(this._transformUniformLocations.u_projection, true, this.getTransformationMatrix());\n\n    context.beginTransformFeedback(context.POINTS);\n    context.drawArraysInstanced(context.POINTS, 0, this._size, 1);\n    context.endTransformFeedback();\n    context.disable(context.RASTERIZER_DISCARD);\n\n    context.bindBufferBase(context.TRANSFORM_FEEDBACK_BUFFER, 0, null);\n    context.bindVertexArray(null);\n    context.useProgram(null);\n  }\n\n  encode(context, options = {}) {\n    // TODO: vertex shader to transform x/y from that function's space to the screen space\n\n    context.useProgram(this._program);\n\n    context.viewport(0.0, 0.0, options.resolution[0], options.resolution[1]);\n\n    if (options.beforeEncode) {\n      options.beforeEncode(context, this);\n    }\n\n    if (options.encodeClear) {\n      options.encodeClear(context, this);\n    }\n\n    context.uniform4fv(this._uniformLocations.u_lineColor, this._lineColor);\n    context.bindVertexArray(this._drawVertexArray);\n\n    if (options.encodeDraw) {\n      options.encodeDraw(context,this);\n    } else {\n      context.drawArrays(context.TRIANGLE_STRIP, 0, this._size * 2);\n    }\n\n    if (options.afterEncode) {\n      options.afterEncode(context, this);\n    }\n  }\n\n  increment() {\n    this._currentIndex = (this._currentIndex + 1) % this._size;\n  }\n\n  push(data) {\n    this.increment();\n    this.setDataPoint(this._currentIndex, data);\n\n    this.updateMax(data[1]);\n    this.updateMin(data[1]);\n  }\n\n  updateMax(value) {\n    if (this._max.dynamic) {\n      if (value > this._max.value) {\n        this._max.value = value;\n        this._max.index = this._currentIndex;\n        this._max.age = 0;\n      } else {\n        if (this._max.age > this._max.expiresAfter) {\n          // find the new max & index\n          var newMax = Number.NEGATIVE_INFINITY;\n          var newAge = 0;\n          var newIndex = this._size - 1;\n\n          for (var i = 0; i < this._size; i++) {\n            var thisIndex = (this._currentIndex + i) % this._size;\n            var data = this.getDataPoint(thisIndex);\n            if (data[1] > newMax) {\n              newMax = data[1];\n              newAge = this._size - i - 1;\n              newIndex = i;\n            }\n          }\n\n          this._max.value = newMax;\n          this._max.age = newAge;\n          this._max.index = newIndex;\n        } else {\n          this._max.age++;\n        }\n      }\n    } else {\n      this._max.value = (value > this._max ? value : this._max.value);\n    }\n  }\n\n  updateMin(value) {\n    if (this._min.dynamic) {\n      if (value < this._min.value) {\n        this._min.value = value;\n        this._min.index = this._currentIndex;\n        this._min.age = 0;\n      } else {\n        if (this._min.age > this._min.expiresAfter) {\n          // find the new min & index\n          var newMin = Number.POSITIVE_INFINITY;\n          var newAge = 0;\n          var newIndex = this._size - 1;\n\n          for (var i = 0; i < this._size; i++) {\n            var thisIndex = (this._currentIndex + i) % this._size;\n            var data = this.getDataPoint(thisIndex);\n            if (data[1] < newMin) {\n              newMin = data[1];\n              newAge = this._size - i - 1;\n              newIndex = i;\n            }\n          }\n\n          this._min.value = newMin;\n          this._min.age = newAge;\n          this._min.index = newIndex;\n        } else {\n          this._min.age++;\n        }\n      }\n    } else {\n      this._min.value = (value < this._min ? value : this._min.value);\n    }\n  }\n\n  writeBuffers(context) {\n    context.bindBuffer(context.ARRAY_BUFFER, this._buffers.pos);\n\n    // rearrange the circular buffer so it can be drawn with triangle strips\n    var posCopy = new Float32Array(this._size * 2);\n    posCopy.set(this._pos.subarray((this._currentIndex + 1) * 2, this._size * 2), 0);\n    posCopy.set(this._pos.subarray(0, (this._currentIndex + 1) * 2), (this._size - this._currentIndex - 1) * 2);\n    context.bufferData(context.ARRAY_BUFFER, posCopy, context.STATIC_DRAW);\n\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n  }\n\n  prepareBuffers(context, pos) {\n    var vertexPosBuffer = context.createBuffer();\n    context.bindBuffer(context.ARRAY_BUFFER, vertexPosBuffer);\n    context.bufferData(context.ARRAY_BUFFER, pos, context.STATIC_DRAW);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    var vertexPosTransformedBuffer = context.createBuffer();\n    context.bindBuffer(context.ARRAY_BUFFER, vertexPosTransformedBuffer);\n    context.bufferData(context.ARRAY_BUFFER, this._size * 8 * Float32Array.BYTES_PER_ELEMENT, context.STREAM_COPY);\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n\n    return {\n      pos: vertexPosBuffer,\n      posTransformed: vertexPosTransformedBuffer,\n    };\n  }\n\n  prepareVertexArray(context, buffers) {\n    var vertexArray = context.createVertexArray();\n    context.bindVertexArray(vertexArray);\n\n    var vertexPosIdx = 0;\n    context.bindBuffer(context.ARRAY_BUFFER, buffers.pos);\n    context.vertexAttribPointer(vertexPosIdx, 2, context.FLOAT, false, 0, 0);\n    context.enableVertexAttribArray(vertexPosIdx);\n\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n    context.bindVertexArray(null);\n\n    return vertexArray;\n  }\n\n  prepareTransformVertexArray(context, buffers) {\n    var vertexArray = context.createVertexArray();\n    context.bindVertexArray(vertexArray);\n\n    var vertexPosIdx = 0;\n    context.bindBuffer(context.ARRAY_BUFFER, buffers.posTransformed);\n    context.vertexAttribPointer(vertexPosIdx, 4, context.FLOAT, false, 32, 0);\n    context.enableVertexAttribArray(vertexPosIdx);\n\n    var vertexPosIdx2 = 1;\n    context.vertexAttribPointer(vertexPosIdx2, 4, context.FLOAT, false, 32, 16);\n    context.enableVertexAttribArray(vertexPosIdx2);\n\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n    context.bindVertexArray(null);\n\n    return vertexArray;\n  }\n\n  prepareDrawVertexArray(context, buffers) {\n    var vertexArray = context.createVertexArray();\n    context.bindVertexArray(vertexArray);\n\n    var vertexPosIdx = 0;\n    context.bindBuffer(context.ARRAY_BUFFER, buffers.posTransformed);\n    context.vertexAttribPointer(vertexPosIdx, 4, context.FLOAT, false, 0, 0);\n    context.enableVertexAttribArray(vertexPosIdx);\n\n    context.bindBuffer(context.ARRAY_BUFFER, null);\n    context.bindVertexArray(null);\n\n    return vertexArray;\n  }\n\n  getTransformationMatrix() {\n    // TODO: update to draw a scanning graph\n\n    var tCurrent = this.getDataPoint(this._currentIndex)[0];\n    var tEarliest = this.getDataPoint((this._currentIndex + 1) % this._size)[0];\n    var tRange = tCurrent - tEarliest;\n    var tMid = tEarliest + tRange/2;\n\n    var yMin = this._min.value;\n    var yMax = this._max.value;\n    var yRange = yMax - yMin;\n\n    var translate = mat4.fromValues(\n      2/tRange, 0, 0, 2*(-tEarliest - tRange/2)/tRange,\n      0, 2/yRange, 0, 2*(-yMin - yRange/2)/yRange,\n      0, 0, 1, -0.0001,\n      0, 0, 0, 1\n    );\n\n    return translate;\n  }\n}\n\nexport { LinePlot };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/LinePlot.js\n// module id = 3\n// module chunks = 0","import { PlatformUtil } from './platform.js';\nimport { MicService } from './audio.js';\n\nexport { PlatformUtil as Platform };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/util/index.js\n// module id = 4\n// module chunks = 0","class PlatformUtil {\n\n  static appendLabel(container, message, options = { icon: \"info-sign\", bsColor: \"danger\" }) {\n    var bsGlyph = options.bsGlyph, bsColor = options.bsColor;\n    var labelSpan = document.createElement('span');\n    labelSpan.classList.add('label', `label-${bsColor}`, 'animation-alert');\n\n    var glyph = `<i class=\"fa fa-lg fa-info-circle\"></i>&nbsp;`;\n    labelSpan.innerHTML = glyph + message;\n\n    container.appendChild(labelSpan);\n  }\n\n  static checkEs6() {\n    try {\n      return ('function' === typeof Map)\n    } catch (e) {\n      return false;\n    }\n  }\n\n  static checkMobile() {\n    var check = false;\n    (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);\n    return check;\n  }\n\n  /**\n   * for some reason, the canvas on te.xel.io ends up being ~10 px too small for its\n   * container. this appears to be a bug that happens in Chrome (not Firefox AFAIK) but\n   * only in conjunction with the CSS layout i'm using...\n   *\n   * @param container the canvas container\n   * @param canvas the canvas in the te.xel.io layout\n   * @param uiBar the bottom ui bar\n   */\n  static fixCanvasUIBar(container, canvas, navbar) {\n    var canvasHeight = window.getComputedStyle(canvas).height;\n    var containerHeight = window.getComputedStyle(container).height;\n\n    canvasHeight = parseFloat(canvasHeight.substr(0, canvasHeight.length - 2));\n    containerHeight = parseFloat(containerHeight.substr(0, containerHeight.length - 2));\n\n    var shadowPaddingHeight = canvasHeight - containerHeight;\n    if (shadowPaddingHeight < 0) {\n      navbar.style.marginTop = `${shadowPaddingHeight}px`;\n    }\n  }\n\n}\n\nexport { PlatformUtil };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/util/platform.js\n// module id = 5\n// module chunks = 0","// TODO: construct basic webaudio mic service\n// TODO: decide how to connect web audio nodes together for easy Mic/FFT => ScriptNode => ArrayBuffer\n\nclass MicService {\n\n}\n\nexport { MicService };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../lib/util/audio.js\n// module id = 6\n// module chunks = 0"],"sourceRoot":""}